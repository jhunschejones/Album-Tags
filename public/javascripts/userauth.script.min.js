console.log('The custom script for the userauth page is running');function hideDOMelement(elementId){try{var element=document.getElementById(elementId)
try{element.style.display="none"}catch(error){function logError(){var newKey=firebase.database().ref().child('errors').push().key;firebase.database().ref('errors/'+newKey).update({"error":{"elementId":elementId,"User":userID,"URL":window.location.href,"Date_Time":new Date().toLocaleString(),"Error":JSON.stringify(error,Object.getOwnPropertyNames(error))}})}
logError()}}catch(error){}}
function showDOMelement(elementId){try{var element=document.getElementById(elementId)
try{element.style.display="block"}catch(error){function logError(){var newKey=firebase.database().ref().child('errors').push().key;firebase.database().ref('errors/'+newKey).update({"error":{"elementId":elementId,"User":userID,"URL":window.location.href,"Date_Time":new Date().toLocaleString(),"Error":JSON.stringify(error,Object.getOwnPropertyNames(error))}})}
logError()}}catch(error){}}
var config={apiKey:"AIzaSyD1Hts7zVBvDXUf-sCb89hcPesJkrUKyUc",authDomain:"album-tag-auth.firebaseapp.com",databaseURL:"https://album-tag-auth.firebaseio.com/",projectId:"album-tag-auth",storageBucket:"album-tag-auth.appspot.com",messagingSenderId:"1048555394172"};const defaultApp=firebase.initializeApp(config);const connectionsApp=firebase.initializeApp({apiKey:"AIzaSyD1Hts7zVBvDXUf-sCb89hcPesJkrUKyUc",databaseURL:"https://album-tag-connections.firebaseio.com/",projectId:"album-tag-auth"},'app2');const favoritesApp=firebase.initializeApp({apiKey:"AIzaSyD1Hts7zVBvDXUf-sCb89hcPesJkrUKyUc",databaseURL:"https://album-tag-favorites.firebaseio.com/",projectId:"album-tag-auth"},'app3');const connectionsDatabase=firebase.database(connectionsApp);const favoritesDatabase=firebase.database(favoritesApp);var loginButton=document.getElementById("login_button");var loginButton2=document.getElementById("full_menu_login_button")
var logoutButton=document.getElementById("logout_button");var logoutButton2=document.getElementById("full_menu_logout_button")
var logInMessage=document.getElementById("log_in_message");var loader=document.getElementById("loader");var userEmail="";var userName="";var user=firebase.auth().currentUser;var userID;var dbRefrence;function signInFunctionality(user){$('.hide_when_logged_in').addClass('hide_me');$('.hide_when_logged_out').removeClass('hide_me');showDOMelement("full_menu_login_logout_container");userEmail=user.email;userName=user.displayName;userID=user.uid;try{updateFavoriteAlbums()}catch(error){}
try{updateConnectedAlbums()}catch(error){}
try{populateUserData()}catch(error){}
try{populateTags("start")}catch(error){}
const allowedUsers=["joshjones103@gmail.com","znoffy5@gmail.com","devon.curry891@gmail.com","milesjohnsonmusic@gmail.com","austinhuelsbeck@gmail.com"];if(allowedUsers.indexOf(userEmail)>-1){tagUpdatePermissionsGranted();var whatTagsToShow=sessionStorage.getItem('tags');if(whatTagsToShow=='My Tags'||whatTagsToShow==undefined){sessionStorage.setItem('tags','My Tags');filterDisplayedTags()}else if(whatTagsToShow=="All Tags"){sessionStorage.setItem('tags','All Tags');allTagsNoFilter()}
var whatConnectionsToShow=sessionStorage.getItem('connections');if(whatConnectionsToShow=="My Connections"||whatConnectionsToShow==undefined){sessionStorage.setItem('connections','My Connections');filterDisplayedConnections()}else if(whatConnectionsToShow=="All Connections"){sessionStorage.setItem('connections','All Connections');allConnectionsNoFilter()}}
else{tagUpdatePermissionsGranted();var whatTagsToShow=sessionStorage.getItem('tags');if(whatTagsToShow=='My Tags'||whatTagsToShow==undefined){sessionStorage.setItem('tags','My Tags');filterDisplayedTags()}else if(whatTagsToShow=="All Tags"){sessionStorage.setItem('tags','All Tags');allTagsNoFilter()}
var whatConnectionsToShow=sessionStorage.getItem('connections');if(whatConnectionsToShow=="My Connections"||whatConnectionsToShow==undefined){sessionStorage.setItem('connections','My Connections');filterDisplayedConnections()}else if(whatConnectionsToShow=="All Connections"){sessionStorage.setItem('connections','All Connections');allConnectionsNoFilter()}}}
var sessionId=JSON.parse(sessionStorage.getItem('sessionId'));var sessionLogin=!1
if(sessionId!=null){sessionLogin=!0;console.log("Session storage login");signInFunctionality(sessionId)}
firebase.auth().onAuthStateChanged(function(user){if(sessionLogin===!1){if(user){sessionStorage.setItem('sessionId',JSON.stringify(user));console.log("Firebase login")
signInFunctionality(user)}else{noUserSignedIn()}}});function noUserSignedIn(){try{logInMessage.innerHTML='<div class="container-fluid please_log_in"><p class="text-danger">Please sign in to access this feature</p> <button onclick="logIn()" class="btn btn-danger" id="login_link">Log In</button></div>'}catch(error){}
hideDOMelement("loader");$('.hide_when_logged_in').removeClass('hide_me');$('.hide_when_logged_out').addClass('hide_me');showDOMelement("full_menu_login_logout_container")}
function tagUpdatePermissionsGranted(){var whatTagsToShow=sessionStorage.getItem('tags');if(whatTagsToShow!='My Tags'&whatTagsToShow!='All Tags'){sessionStorage.setItem('tags','My Tags')}
$("#update_button_container").html('<a href="" onclick="goToUpdatePage()" class="btn btn-sm btn-outline-secondary update_button hide_when_logged_out">Update<span class="button_text"> Tags</span></a>');$("#tags_toggle").html('<img src="/images/toggle_off.png" id="show_only_my_tags" class="hide_when_logged_out" style="height:22px;margin-left:10px;" onclick="showAllTags()" data-toggle="tooltip" data-placement="right" title="Show All Tags" data-trigger="hover"><img src="/images/toggle_on.png" class="hide_when_logged_out" id="show_all_tags" style="height:22px;margin-left:10px;" onclick="showOnlyMyTags()" data-toggle="tooltip" data-placement="right" title="Only Show My Tags" data-trigger="hover">');$("#connections_toggle").html('<img src="/images/toggle_off.png" id="show_only_my_connections" class="hide_when_logged_out" style="height:22px;margin-left:10px;" onclick="showAllConnections()" data-toggle="tooltip" data-placement="right" title="Show All Connections" data-trigger="hover"><img src="/images/toggle_on.png" class="hide_when_logged_out" id="show_all_connections" style="height:22px;margin-left:10px;" onclick="showOnlyMyConnections()" data-toggle="tooltip" data-placement="right" title="Only Show My Connections" data-trigger="hover">');$("#connection_button_container").html('<a href="" onclick="goToUpdatePage()" class="btn btn-sm btn-outline-secondary update_button hide_when_logged_out">Update Connections</a>');try{logInMessage.innerHTML=""}catch(error){}
try{checkUserDisplayPrefrences()}catch(error){}}
function filterDisplayedTags(){try{let anyTagsOnPage=!1
tagsForThisAlbum=$(".album_details_tags")
for(let index=0;index<tagsForThisAlbum.length;index++){let thisTag=tagsForThisAlbum[index];if($(thisTag).hasClass(`author-${userID}`)){$(thisTag).show()
anyTagsOnPage=!0}else{$(thisTag).hide()}}
if(anyTagsOnPage==!0){$(".tag_search_button").show()
$('#tag_results').show()
$('#tag_results_message').html('')}else{$(".tag_search_button").hide()
$('#tag_results').hide()
$('#tag_results_message').html('<small class="text-primary">You currently have no tags for this album!</small>')}}catch(error){}}
function allTagsNoFilter(){try{let anyTagsOnPage=!1
tagsForThisAlbum=$(".album_details_tags")
if(tagsForThisAlbum.length>0){anyTagsOnPage=!0
for(let index=0;index<tagsForThisAlbum.length;index++){let thisTag=tagsForThisAlbum[index];$(thisTag).show()}}
if(anyTagsOnPage==!0){$(".tag_search_button").show()
$('#tag_results').show()
$('#tag_results_message').html('')}else{$(".tag_search_button").hide()
$('#tag_results').hide()
$('#tag_results_message').html('<small class="text-primary">There are currently no tags for this album!</small>')}}catch(error){}}
function filterDisplayedConnections(){try{let anyConnectionsOnPage=!1
connectionsForThisAlbum=$(".connection")
for(let index=0;index<connectionsForThisAlbum.length;index++){let connection=connectionsForThisAlbum[index];if($(connection).hasClass(`author-${userID}`)){$(connection).show()
anyConnectionsOnPage=!0}else{$(connection).hide()}}
if(anyConnectionsOnPage==!0){$('#connection_results').show()
$('#connection_results_message').html('')}else{$('#connection_results').hide()
$('#connection_results_message').html('<small class="text-primary">You currently have no connections for this album!</small>')}}catch(error){}}
function allConnectionsNoFilter(){try{let anyConnectionsOnPage=!1
connectionsForThisAlbum=$(".connection")
if(connectionsForThisAlbum.length>0){anyConnectionsOnPage=!0
for(let index=0;index<connectionsForThisAlbum.length;index++){let thisConnection=connectionsForThisAlbum[index];$(thisConnection).show()}}
if(anyConnectionsOnPage==!0){$('#connection_results').show()
$('#connection_results_message').html('')}else{$('#connection_results').show()
$('#connection_results_message').html('<small class="text-primary">There are currently no connections for this album!</small>')}}catch(error){}}
function logIn(){firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(function(){var provider=new firebase.auth.GoogleAuthProvider();return firebase.auth().signInWithPopup(provider)}).then(function(result){var token=result.credential.accessToken;userEmail=result.user.email}).catch(function(error){var errorCode=error.code;var errorMessage=error.message;var email=error.email;var credential=error.credential})};function goToUpdatePage(){event.preventDefault();let url=window.location.href;url=url.replace("albumdetails","update");window.location=url};function logOut(){firebase.auth().signOut().then(function(){storage.removeItem('sessionId');noUserSignedIn()}).catch(function(error){})};loginButton.addEventListener("click",logIn);loginButton2.addEventListener("click",logIn);logoutButton.addEventListener("click",logOut);logoutButton2.addEventListener("click",logOut)